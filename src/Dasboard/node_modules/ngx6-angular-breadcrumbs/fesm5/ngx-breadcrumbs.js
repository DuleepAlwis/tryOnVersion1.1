import { from, of, Observable, BehaviorSubject } from 'rxjs';
import * as template from 'lodash.template';
import * as templateSettings from 'lodash.templatesettings';
import { Injectable, Injector, Component, NgModule } from '@angular/core';
import { NavigationEnd, Router, RouterModule } from '@angular/router';
import { flatMap, distinct, toArray, concat, first, filter } from 'rxjs/operators';
import { CommonModule } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/** @type {?} */
var _ = {
    template: template,
    templateSettings: templateSettings
};
_.templateSettings.interpolate = /{{([\s\S]+?)}}/g;
/**
 * @param {?} template
 * @param {?} binding
 * @return {?}
 */
function stringFormat(template$$1, binding) {
    /** @type {?} */
    var compiled = _.template(template$$1);
    return compiled(binding);
}
/**
 * @param {?} value
 * @return {?}
 */
function isPromise(value) {
    return value && typeof value.then === 'function';
}
/**
 * @template T
 * @param {?} value
 * @return {?}
 */
function wrapIntoObservable(value) {
    if (value instanceof Observable) {
        return value;
    }
    if (isPromise(value)) {
        return from(Promise.resolve(value));
    }
    return of(/** @type {?} */ (value));
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
var McBreadcrumbsConfig = /** @class */ (function () {
    function McBreadcrumbsConfig() {
    }
    McBreadcrumbsConfig.decorators = [
        { type: Injectable },
    ];
    return McBreadcrumbsConfig;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
var McBreadcrumbsResolver = /** @class */ (function () {
    function McBreadcrumbsResolver() {
    }
    /**
     * @param {?} route
     * @param {?} state
     * @return {?}
     */
    McBreadcrumbsResolver.prototype.resolve = /**
     * @param {?} route
     * @param {?} state
     * @return {?}
     */
    function (route, state) {
        /** @type {?} */
        var data = route.routeConfig.data;
        /** @type {?} */
        var path = this.getFullPath(route);
        /** @type {?} */
        var text = typeof data["breadcrumbs"] === 'string'
            ? data["breadcrumbs"] : data["breadcrumbs"].text || data["text"] || path;
        text = stringFormat(text, route.data);
        /** @type {?} */
        var crumbs = [
            {
                text: text,
                path: path
            }
        ];
        return of(crumbs);
    };
    /**
     * @param {?} route
     * @return {?}
     */
    McBreadcrumbsResolver.prototype.getFullPath = /**
     * @param {?} route
     * @return {?}
     */
    function (route) {
        /** @type {?} */
        var relativePath = function (segments) {
            return segments.reduce(function (a, v) { return (a += '/' + v.path); }, '');
        };
        /** @type {?} */
        var fullPath = function (routes) {
            return routes.reduce(function (a, v) { return (a += relativePath(v.url)); }, '');
        };
        return fullPath(route.pathFromRoot);
    };
    return McBreadcrumbsResolver;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
var McBreadcrumbsService = /** @class */ (function () {
    function McBreadcrumbsService(_router, _config, _injector) {
        var _this = this;
        this._router = _router;
        this._config = _config;
        this._injector = _injector;
        this._breadcrumbs = new BehaviorSubject([]);
        this._defaultResolver = new McBreadcrumbsResolver();
        this._router.events
            .pipe(filter(function (x) { return x instanceof NavigationEnd; }))
            .subscribe(function (event) {
            /** @type {?} */
            var route = _router.routerState.snapshot.root;
            _this._resolveCrumbs(route)
                .pipe(flatMap(function (x) { return x; }), distinct(function (x) { return x.text; }), toArray(), flatMap(function (x) {
                if (_this._config.postProcess) {
                    /** @type {?} */
                    var y = _this._config.postProcess(x);
                    return wrapIntoObservable(y).pipe(first());
                }
                else {
                    return of(x);
                }
            }))
                .subscribe(function (x) {
                _this._breadcrumbs.next(x);
            });
        });
    }
    Object.defineProperty(McBreadcrumbsService.prototype, "crumbs$", {
        get: /**
         * @return {?}
         */
        function () {
            return this._breadcrumbs;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} route
     * @return {?}
     */
    McBreadcrumbsService.prototype._resolveCrumbs = /**
     * @param {?} route
     * @return {?}
     */
    function (route) {
        /** @type {?} */
        var crumbs$;
        /** @type {?} */
        var data = route.routeConfig && route.routeConfig.data;
        if (data && data["breadcrumbs"]) {
            /** @type {?} */
            var resolver = void 0;
            if (data["breadcrumbs"].prototype instanceof McBreadcrumbsResolver) {
                resolver = this._injector.get(data["breadcrumbs"]);
            }
            else {
                resolver = this._defaultResolver;
            }
            /** @type {?} */
            var result = resolver.resolve(route, this._router.routerState.snapshot);
            crumbs$ = wrapIntoObservable(result).pipe(first());
        }
        else {
            crumbs$ = of([]);
        }
        if (route.firstChild) {
            crumbs$ = crumbs$.pipe(concat(this._resolveCrumbs(route.firstChild)));
        }
        return crumbs$;
    };
    McBreadcrumbsService.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    McBreadcrumbsService.ctorParameters = function () { return [
        { type: Router },
        { type: McBreadcrumbsConfig },
        { type: Injector }
    ]; };
    return McBreadcrumbsService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
var McBreadcrumbsComponent = /** @class */ (function () {
    function McBreadcrumbsComponent(service) {
        this.service = service;
        this.subscriptions = new Array();
    }
    /**
     * @return {?}
     */
    McBreadcrumbsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var s = this.service.crumbs$.subscribe(function (x) {
            _this.crumbs = x;
        });
    };
    /**
     * @return {?}
     */
    McBreadcrumbsComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.subscriptions.forEach(function (x) { return x.unsubscribe(); });
    };
    McBreadcrumbsComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'mc-breadcrumbs',
                    template: "<ol *ngIf=\"crumbs.length\" class=\"breadcrumb\">\n  <li *ngFor=\"let crumb of crumbs; let last = last\" [ngClass]=\"{ 'active': last }\" class=\"breadcrumb-item\">\n    <a *ngIf=\"!last\" [routerLink]=\"crumb.path\">{{ crumb.text }}</a>\n    <span *ngIf=\"last\">{{ crumb.text }}</span>\n  </li>\n</ol>\n"
                },] },
    ];
    /** @nocollapse */
    McBreadcrumbsComponent.ctorParameters = function () { return [
        { type: McBreadcrumbsService }
    ]; };
    return McBreadcrumbsComponent;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
var McBreadcrumbsModule = /** @class */ (function () {
    function McBreadcrumbsModule() {
    }
    /**
     * @return {?}
     */
    McBreadcrumbsModule.forRoot = /**
     * @return {?}
     */
    function () {
        return {
            ngModule: McBreadcrumbsModule,
            providers: [McBreadcrumbsService, McBreadcrumbsConfig]
        };
    };
    McBreadcrumbsModule.decorators = [
        { type: NgModule, args: [{
                    imports: [CommonModule, RouterModule],
                    declarations: [McBreadcrumbsComponent],
                    exports: [McBreadcrumbsComponent]
                },] },
    ];
    return McBreadcrumbsModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

export { McBreadcrumbsComponent, McBreadcrumbsService, McBreadcrumbsConfig, McBreadcrumbsResolver, McBreadcrumbsModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWJyZWFkY3J1bWJzLmpzLm1hcCIsInNvdXJjZXMiOlsibmc6Ly9uZ3gtYnJlYWRjcnVtYnMvc3JjL21jLWJyZWFkY3J1bWJzLnNoYXJlZC50cyIsIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9zZXJ2aWNlL21jLWJyZWFkY3J1bWJzLmNvbmZpZy50cyIsIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9zZXJ2aWNlL21jLWJyZWFkY3J1bWJzLnJlc29sdmVyLnRzIiwibmc6Ly9uZ3gtYnJlYWRjcnVtYnMvc3JjL3NlcnZpY2UvbWMtYnJlYWRjcnVtYnMuc2VydmljZS50cyIsIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9jb21wb25lbnQvbWMtYnJlYWRjcnVtYnMuY29tcG9uZW50LnRzIiwibmc6Ly9uZ3gtYnJlYWRjcnVtYnMvc3JjL21jLWJyZWFkY3J1bWJzLm1vZHVsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcm9tLCBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgKiBhcyB0ZW1wbGF0ZSBmcm9tICdsb2Rhc2gudGVtcGxhdGUnO1xuaW1wb3J0ICogYXMgdGVtcGxhdGVTZXR0aW5ncyBmcm9tICdsb2Rhc2gudGVtcGxhdGVzZXR0aW5ncyc7XG5cbmNvbnN0IF8gPSB7XG4gIHRlbXBsYXRlOiB0ZW1wbGF0ZSxcbiAgdGVtcGxhdGVTZXR0aW5nczogdGVtcGxhdGVTZXR0aW5nc1xufTtcblxuXy50ZW1wbGF0ZVNldHRpbmdzLmludGVycG9sYXRlID0gL3t7KFtcXHNcXFNdKz8pfX0vZztcblxuZXhwb3J0IGludGVyZmFjZSBJQnJlYWRjcnVtYiB7XG4gIHRleHQ6IHN0cmluZztcbiAgcGF0aDogc3RyaW5nO1xufVxuXG5kZWNsYXJlIHZhciByZXF1aXJlOiBhbnk7XG5cbmZ1bmN0aW9uIHIobW9kdWxlKSB7XG4gIHJldHVybiByZXF1aXJlKGAke25hbWV9YCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdGb3JtYXQodGVtcGxhdGU6IHN0cmluZywgYmluZGluZzogYW55KTogc3RyaW5nIHtcbiAgY29uc3QgY29tcGlsZWQgPSBfLnRlbXBsYXRlKHRlbXBsYXRlKTtcbiAgcmV0dXJuIGNvbXBpbGVkKGJpbmRpbmcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQcm9taXNlKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgcmV0dXJuIHZhbHVlICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JhcEludG9PYnNlcnZhYmxlPFQ+KFxuICB2YWx1ZTogVCB8IFByb21pc2U8VD4gfCBPYnNlcnZhYmxlPFQ+XG4pOiBPYnNlcnZhYmxlPFQ+IHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGlmIChpc1Byb21pc2UodmFsdWUpKSB7XG4gICAgcmV0dXJuIGZyb20oUHJvbWlzZS5yZXNvbHZlKHZhbHVlKSk7XG4gIH1cblxuICByZXR1cm4gb2YodmFsdWUgYXMgVCk7XG59XG4iLCJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElCcmVhZGNydW1iIH0gZnJvbSAnLi4vbWMtYnJlYWRjcnVtYnMuc2hhcmVkJztcblxuZXhwb3J0IGludGVyZmFjZSBJUG9zdFByb2Nlc3NGdW5jIHtcbiAgKGNydW1iczogSUJyZWFkY3J1bWJbXSk6XG4gICAgfCBQcm9taXNlPElCcmVhZGNydW1iW10+XG4gICAgfCBPYnNlcnZhYmxlPElCcmVhZGNydW1iW10+XG4gICAgfCBJQnJlYWRjcnVtYltdO1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWNCcmVhZGNydW1ic0NvbmZpZyB7XG4gIHBvc3RQcm9jZXNzOiBJUG9zdFByb2Nlc3NGdW5jO1xufVxuIiwiaW1wb3J0IHtcbiAgQWN0aXZhdGVkUm91dGVTbmFwc2hvdCxcbiAgUmVzb2x2ZSxcbiAgUm91dGVyU3RhdGVTbmFwc2hvdCxcbiAgVXJsU2VnbWVudFxufSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSUJyZWFkY3J1bWIsIHN0cmluZ0Zvcm1hdCB9IGZyb20gJy4uL21jLWJyZWFkY3J1bWJzLnNoYXJlZCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuXG5leHBvcnQgY2xhc3MgTWNCcmVhZGNydW1ic1Jlc29sdmVyIGltcGxlbWVudHMgUmVzb2x2ZTxJQnJlYWRjcnVtYltdPiB7XG4gIHB1YmxpYyByZXNvbHZlKFxuICAgIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90LFxuICAgIHN0YXRlOiBSb3V0ZXJTdGF0ZVNuYXBzaG90XG4gICk6IE9ic2VydmFibGU8SUJyZWFkY3J1bWJbXT4gfCBQcm9taXNlPElCcmVhZGNydW1iW10+IHwgSUJyZWFkY3J1bWJbXSB7XG4gICAgY29uc3QgZGF0YSA9IHJvdXRlLnJvdXRlQ29uZmlnLmRhdGE7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMuZ2V0RnVsbFBhdGgocm91dGUpO1xuXG4gICAgbGV0IHRleHQgPVxuICAgICAgdHlwZW9mIGRhdGEuYnJlYWRjcnVtYnMgPT09ICdzdHJpbmcnXG4gICAgICAgID8gZGF0YS5icmVhZGNydW1ic1xuICAgICAgICA6IGRhdGEuYnJlYWRjcnVtYnMudGV4dCB8fCBkYXRhLnRleHQgfHwgcGF0aDtcbiAgICB0ZXh0ID0gc3RyaW5nRm9ybWF0KHRleHQsIHJvdXRlLmRhdGEpO1xuXG4gICAgY29uc3QgY3J1bWJzOiBJQnJlYWRjcnVtYltdID0gW1xuICAgICAge1xuICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICBwYXRoOiBwYXRoXG4gICAgICB9XG4gICAgXTtcblxuICAgIHJldHVybiBvZihjcnVtYnMpO1xuICB9XG5cbiAgcHVibGljIGdldEZ1bGxQYXRoKHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KTogc3RyaW5nIHtcbiAgICBjb25zdCByZWxhdGl2ZVBhdGggPSAoc2VnbWVudHM6IFVybFNlZ21lbnRbXSkgPT5cbiAgICAgIHNlZ21lbnRzLnJlZHVjZSgoYSwgdikgPT4gKGEgKz0gJy8nICsgdi5wYXRoKSwgJycpO1xuICAgIGNvbnN0IGZ1bGxQYXRoID0gKHJvdXRlczogQWN0aXZhdGVkUm91dGVTbmFwc2hvdFtdKSA9PlxuICAgICAgcm91dGVzLnJlZHVjZSgoYSwgdikgPT4gKGEgKz0gcmVsYXRpdmVQYXRoKHYudXJsKSksICcnKTtcblxuICAgIHJldHVybiBmdWxsUGF0aChyb3V0ZS5wYXRoRnJvbVJvb3QpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90LCBOYXZpZ2F0aW9uRW5kLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBmbGF0TWFwLFxuICBkaXN0aW5jdCxcbiAgdG9BcnJheSxcbiAgY29uY2F0LFxuICBmaXJzdCxcbiAgZmlsdGVyXG59IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgSUJyZWFkY3J1bWIsIHdyYXBJbnRvT2JzZXJ2YWJsZSB9IGZyb20gJy4uL21jLWJyZWFkY3J1bWJzLnNoYXJlZCc7XG5pbXBvcnQgeyBNY0JyZWFkY3J1bWJzQ29uZmlnIH0gZnJvbSAnLi9tYy1icmVhZGNydW1icy5jb25maWcnO1xuaW1wb3J0IHsgTWNCcmVhZGNydW1ic1Jlc29sdmVyIH0gZnJvbSAnLi9tYy1icmVhZGNydW1icy5yZXNvbHZlcic7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNY0JyZWFkY3J1bWJzU2VydmljZSB7XG4gIHByaXZhdGUgX2JyZWFkY3J1bWJzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxJQnJlYWRjcnVtYltdPihbXSk7XG4gIHByaXZhdGUgX2RlZmF1bHRSZXNvbHZlciA9IG5ldyBNY0JyZWFkY3J1bWJzUmVzb2x2ZXIoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9yb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIF9jb25maWc6IE1jQnJlYWRjcnVtYnNDb25maWcsXG4gICAgcHJpdmF0ZSBfaW5qZWN0b3I6IEluamVjdG9yXG4gICkge1xuICAgIHRoaXMuX3JvdXRlci5ldmVudHNcbiAgICAgIC5waXBlKGZpbHRlcih4ID0+IHggaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRW5kKSlcbiAgICAgIC5zdWJzY3JpYmUoKGV2ZW50OiBOYXZpZ2F0aW9uRW5kKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdXRlID0gX3JvdXRlci5yb3V0ZXJTdGF0ZS5zbmFwc2hvdC5yb290O1xuXG4gICAgICAgIHRoaXMuX3Jlc29sdmVDcnVtYnMocm91dGUpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBmbGF0TWFwKHggPT4geCksXG4gICAgICAgICAgICBkaXN0aW5jdCh4ID0+IHgudGV4dCksXG4gICAgICAgICAgICB0b0FycmF5KCksXG4gICAgICAgICAgICBmbGF0TWFwKHggPT4ge1xuICAgICAgICAgICAgICBpZiAodGhpcy5fY29uZmlnLnBvc3RQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuX2NvbmZpZy5wb3N0UHJvY2Vzcyh4KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JhcEludG9PYnNlcnZhYmxlPElCcmVhZGNydW1iW10+KHkpLnBpcGUoZmlyc3QoKSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcblxuICAgICAgICAgIC5zdWJzY3JpYmUoeCA9PiB7XG4gICAgICAgICAgICB0aGlzLl9icmVhZGNydW1icy5uZXh0KHgpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBnZXQgY3J1bWJzJCgpOiBPYnNlcnZhYmxlPElCcmVhZGNydW1iW10+IHtcbiAgICByZXR1cm4gdGhpcy5fYnJlYWRjcnVtYnM7XG4gIH1cblxuICBwcml2YXRlIF9yZXNvbHZlQ3J1bWJzKFxuICAgIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90XG4gICk6IE9ic2VydmFibGU8SUJyZWFkY3J1bWJbXT4ge1xuICAgIGxldCBjcnVtYnMkOiBPYnNlcnZhYmxlPElCcmVhZGNydW1iW10+O1xuXG4gICAgY29uc3QgZGF0YSA9IHJvdXRlLnJvdXRlQ29uZmlnICYmIHJvdXRlLnJvdXRlQ29uZmlnLmRhdGE7XG5cbiAgICBpZiAoZGF0YSAmJiBkYXRhLmJyZWFkY3J1bWJzKSB7XG4gICAgICBsZXQgcmVzb2x2ZXI6IE1jQnJlYWRjcnVtYnNSZXNvbHZlcjtcblxuICAgICAgaWYgKGRhdGEuYnJlYWRjcnVtYnMucHJvdG90eXBlIGluc3RhbmNlb2YgTWNCcmVhZGNydW1ic1Jlc29sdmVyKSB7XG4gICAgICAgIHJlc29sdmVyID0gdGhpcy5faW5qZWN0b3IuZ2V0KGRhdGEuYnJlYWRjcnVtYnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZXIgPSB0aGlzLl9kZWZhdWx0UmVzb2x2ZXI7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc29sdmVyLnJlc29sdmUocm91dGUsIHRoaXMuX3JvdXRlci5yb3V0ZXJTdGF0ZS5zbmFwc2hvdCk7XG4gICAgICBjcnVtYnMkID0gd3JhcEludG9PYnNlcnZhYmxlPElCcmVhZGNydW1iW10+KHJlc3VsdCkucGlwZShmaXJzdCgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3J1bWJzJCA9IG9mKFtdKTtcbiAgICB9XG5cbiAgICBpZiAocm91dGUuZmlyc3RDaGlsZCkge1xuICAgICAgY3J1bWJzJCA9IGNydW1icyQucGlwZShjb25jYXQodGhpcy5fcmVzb2x2ZUNydW1icyhyb3V0ZS5maXJzdENoaWxkKSkpO1xuICAgIH1cblxuICAgIHJldHVybiBjcnVtYnMkO1xuICB9XG59XG4iLCJpbXBvcnQgeyBNY0JyZWFkY3J1bWJzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2UvbWMtYnJlYWRjcnVtYnMuc2VydmljZSc7XG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElCcmVhZGNydW1iIH0gZnJvbSAnLi4vbWMtYnJlYWRjcnVtYnMuc2hhcmVkJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ21jLWJyZWFkY3J1bWJzJyxcbiAgdGVtcGxhdGU6IGA8b2wgKm5nSWY9XCJjcnVtYnMubGVuZ3RoXCIgY2xhc3M9XCJicmVhZGNydW1iXCI+XG4gIDxsaSAqbmdGb3I9XCJsZXQgY3J1bWIgb2YgY3J1bWJzOyBsZXQgbGFzdCA9IGxhc3RcIiBbbmdDbGFzc109XCJ7ICdhY3RpdmUnOiBsYXN0IH1cIiBjbGFzcz1cImJyZWFkY3J1bWItaXRlbVwiPlxuICAgIDxhICpuZ0lmPVwiIWxhc3RcIiBbcm91dGVyTGlua109XCJjcnVtYi5wYXRoXCI+e3sgY3J1bWIudGV4dCB9fTwvYT5cbiAgICA8c3BhbiAqbmdJZj1cImxhc3RcIj57eyBjcnVtYi50ZXh0IH19PC9zcGFuPlxuICA8L2xpPlxuPC9vbD5cbmBcbn0pXG5leHBvcnQgY2xhc3MgTWNCcmVhZGNydW1ic0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgY29uc3RydWN0b3IocHVibGljIHNlcnZpY2U6IE1jQnJlYWRjcnVtYnNTZXJ2aWNlKSB7fVxuXG4gIGNydW1iczogSUJyZWFkY3J1bWJbXTtcblxuICBzdWJzY3JpcHRpb25zID0gbmV3IEFycmF5PFN1YnNjcmlwdGlvbj4oKTtcblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgcyA9IHRoaXMuc2VydmljZS5jcnVtYnMkLnN1YnNjcmliZSh4ID0+IHtcbiAgICAgIHRoaXMuY3J1bWJzID0geDtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHggPT4geC51bnN1YnNjcmliZSgpKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUm91dGVyTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBNY0JyZWFkY3J1bWJzU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9tYy1icmVhZGNydW1icy5zZXJ2aWNlJztcbmltcG9ydCB7IE1vZHVsZVdpdGhQcm92aWRlcnMsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNY0JyZWFkY3J1bWJzQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQvbWMtYnJlYWRjcnVtYnMuY29tcG9uZW50JztcbmltcG9ydCB7IE1jQnJlYWRjcnVtYnNDb25maWcgfSBmcm9tICcuL3NlcnZpY2UvbWMtYnJlYWRjcnVtYnMuY29uZmlnJztcblxuQE5nTW9kdWxlKHtcbiAgaW1wb3J0czogW0NvbW1vbk1vZHVsZSwgUm91dGVyTW9kdWxlXSxcbiAgZGVjbGFyYXRpb25zOiBbTWNCcmVhZGNydW1ic0NvbXBvbmVudF0sXG4gIGV4cG9ydHM6IFtNY0JyZWFkY3J1bWJzQ29tcG9uZW50XVxufSlcbmV4cG9ydCBjbGFzcyBNY0JyZWFkY3J1bWJzTW9kdWxlIHtcbiAgc3RhdGljIGZvclJvb3QoKTogTW9kdWxlV2l0aFByb3ZpZGVycyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5nTW9kdWxlOiBNY0JyZWFkY3J1bWJzTW9kdWxlLFxuICAgICAgcHJvdmlkZXJzOiBbTWNCcmVhZGNydW1ic1NlcnZpY2UsIE1jQnJlYWRjcnVtYnNDb25maWddXG4gICAgfTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInRlbXBsYXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTtBQUtBLElBQU0sQ0FBQyxHQUFHO0lBQ1IsUUFBUSxFQUFFLFFBQVE7SUFDbEIsZ0JBQWdCLEVBQUUsZ0JBQWdCO0NBQ25DLENBQUM7QUFFRixDQUFDLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxHQUFHLGlCQUFpQixDQUFDOzs7Ozs7QUFhbkQsc0JBQTZCQSxXQUFnQixFQUFFLE9BQVk7O0lBQ3pELElBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUNBLFdBQVEsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0NBQzFCOzs7OztBQUVELG1CQUEwQixLQUFVO0lBQ2xDLE9BQU8sS0FBSyxJQUFJLE9BQU8sS0FBSyxDQUFDLElBQUksS0FBSyxVQUFVLENBQUM7Q0FDbEQ7Ozs7OztBQUVELDRCQUNFLEtBQXFDO0lBRXJDLElBQUksS0FBSyxZQUFZLFVBQVUsRUFBRTtRQUMvQixPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDcEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0tBQ3JDO0lBRUQsT0FBTyxFQUFFLG1CQUFDLEtBQVUsRUFBQyxDQUFDO0NBQ3ZCOzs7Ozs7QUMxQ0Q7Ozs7Z0JBVUMsVUFBVTs7OEJBWlg7Ozs7Ozs7QUNNQSxJQUdBOzs7Ozs7OztJQUNTLHVDQUFPOzs7OztjQUNaLEtBQTZCLEVBQzdCLEtBQTBCOztRQUUxQixJQUFNLElBQUksR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQzs7UUFDcEMs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