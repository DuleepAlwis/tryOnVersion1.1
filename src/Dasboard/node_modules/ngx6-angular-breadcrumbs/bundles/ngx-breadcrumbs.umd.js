(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('rxjs'), require('lodash.template'), require('lodash.templatesettings'), require('@angular/core'), require('@angular/router'), require('rxjs/operators'), require('@angular/common')) :
    typeof define === 'function' && define.amd ? define('ngx-breadcrumbs', ['exports', 'rxjs', 'lodash.template', 'lodash.templatesettings', '@angular/core', '@angular/router', 'rxjs/operators', '@angular/common'], factory) :
    (factory((global['ngx-breadcrumbs'] = {}),global.rxjs,null,null,global.ng.core,global.ng.router,global.rxjs.operators,global.ng.common));
}(this, (function (exports,rxjs,template,templateSettings,core,router,operators,common) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    /** @type {?} */
    var _ = {
        template: template,
        templateSettings: templateSettings
    };
    _.templateSettings.interpolate = /{{([\s\S]+?)}}/g;
    /**
     * @param {?} template
     * @param {?} binding
     * @return {?}
     */
    function stringFormat(template$$1, binding) {
        /** @type {?} */
        var compiled = _.template(template$$1);
        return compiled(binding);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    function isPromise(value) {
        return value && typeof value.then === 'function';
    }
    /**
     * @template T
     * @param {?} value
     * @return {?}
     */
    function wrapIntoObservable(value) {
        if (value instanceof rxjs.Observable) {
            return value;
        }
        if (isPromise(value)) {
            return rxjs.from(Promise.resolve(value));
        }
        return rxjs.of(/** @type {?} */ (value));
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var McBreadcrumbsConfig = (function () {
        function McBreadcrumbsConfig() {
        }
        McBreadcrumbsConfig.decorators = [
            { type: core.Injectable },
        ];
        return McBreadcrumbsConfig;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var McBreadcrumbsResolver = (function () {
        function McBreadcrumbsResolver() {
        }
        /**
         * @param {?} route
         * @param {?} state
         * @return {?}
         */
        McBreadcrumbsResolver.prototype.resolve = /**
         * @param {?} route
         * @param {?} state
         * @return {?}
         */
            function (route, state) {
                /** @type {?} */
                var data = route.routeConfig.data;
                /** @type {?} */
                var path = this.getFullPath(route);
                /** @type {?} */
                var text = typeof data["breadcrumbs"] === 'string'
                    ? data["breadcrumbs"] : data["breadcrumbs"].text || data["text"] || path;
                text = stringFormat(text, route.data);
                /** @type {?} */
                var crumbs = [
                    {
                        text: text,
                        path: path
                    }
                ];
                return rxjs.of(crumbs);
            };
        /**
         * @param {?} route
         * @return {?}
         */
        McBreadcrumbsResolver.prototype.getFullPath = /**
         * @param {?} route
         * @return {?}
         */
            function (route) {
                /** @type {?} */
                var relativePath = function (segments) {
                    return segments.reduce(function (a, v) { return (a += '/' + v.path); }, '');
                };
                /** @type {?} */
                var fullPath = function (routes) {
                    return routes.reduce(function (a, v) { return (a += relativePath(v.url)); }, '');
                };
                return fullPath(route.pathFromRoot);
            };
        return McBreadcrumbsResolver;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var McBreadcrumbsService = (function () {
        function McBreadcrumbsService(_router, _config, _injector) {
            var _this = this;
            this._router = _router;
            this._config = _config;
            this._injector = _injector;
            this._breadcrumbs = new rxjs.BehaviorSubject([]);
            this._defaultResolver = new McBreadcrumbsResolver();
            this._router.events
                .pipe(operators.filter(function (x) { return x instanceof router.NavigationEnd; }))
                .subscribe(function (event) {
                /** @type {?} */
                var route = _router.routerState.snapshot.root;
                _this._resolveCrumbs(route)
                    .pipe(operators.flatMap(function (x) { return x; }), operators.distinct(function (x) { return x.text; }), operators.toArray(), operators.flatMap(function (x) {
                    if (_this._config.postProcess) {
                        /** @type {?} */
                        var y = _this._config.postProcess(x);
                        return wrapIntoObservable(y).pipe(operators.first());
                    }
                    else {
                        return rxjs.of(x);
                    }
                }))
                    .subscribe(function (x) {
                    _this._breadcrumbs.next(x);
                });
            });
        }
        Object.defineProperty(McBreadcrumbsService.prototype, "crumbs$", {
            get: /**
             * @return {?}
             */ function () {
                return this._breadcrumbs;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @param {?} route
         * @return {?}
         */
        McBreadcrumbsService.prototype._resolveCrumbs = /**
         * @param {?} route
         * @return {?}
         */
            function (route) {
                /** @type {?} */
                var crumbs$;
                /** @type {?} */
                var data = route.routeConfig && route.routeConfig.data;
                if (data && data["breadcrumbs"]) {
                    /** @type {?} */
                    var resolver = void 0;
                    if (data["breadcrumbs"].prototype instanceof McBreadcrumbsResolver) {
                        resolver = this._injector.get(data["breadcrumbs"]);
                    }
                    else {
                        resolver = this._defaultResolver;
                    }
                    /** @type {?} */
                    var result = resolver.resolve(route, this._router.routerState.snapshot);
                    crumbs$ = wrapIntoObservable(result).pipe(operators.first());
                }
                else {
                    crumbs$ = rxjs.of([]);
                }
                if (route.firstChild) {
                    crumbs$ = crumbs$.pipe(operators.concat(this._resolveCrumbs(route.firstChild)));
                }
                return crumbs$;
            };
        McBreadcrumbsService.decorators = [
            { type: core.Injectable },
        ];
        /** @nocollapse */
        McBreadcrumbsService.ctorParameters = function () {
            return [
                { type: router.Router },
                { type: McBreadcrumbsConfig },
                { type: core.Injector }
            ];
        };
        return McBreadcrumbsService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var McBreadcrumbsComponent = (function () {
        function McBreadcrumbsComponent(service) {
            this.service = service;
            this.subscriptions = new Array();
        }
        /**
         * @return {?}
         */
        McBreadcrumbsComponent.prototype.ngOnInit = /**
         * @return {?}
         */
            function () {
                var _this = this;
                /** @type {?} */
                var s = this.service.crumbs$.subscribe(function (x) {
                    _this.crumbs = x;
                });
            };
        /**
         * @return {?}
         */
        McBreadcrumbsComponent.prototype.ngOnDestroy = /**
         * @return {?}
         */
            function () {
                this.subscriptions.forEach(function (x) { return x.unsubscribe(); });
            };
        McBreadcrumbsComponent.decorators = [
            { type: core.Component, args: [{
                        // tslint:disable-next-line:component-selector
                        selector: 'mc-breadcrumbs',
                        template: "<ol *ngIf=\"crumbs.length\" class=\"breadcrumb\">\n  <li *ngFor=\"let crumb of crumbs; let last = last\" [ngClass]=\"{ 'active': last }\" class=\"breadcrumb-item\">\n    <a *ngIf=\"!last\" [routerLink]=\"crumb.path\">{{ crumb.text }}</a>\n    <span *ngIf=\"last\">{{ crumb.text }}</span>\n  </li>\n</ol>\n"
                    },] },
        ];
        /** @nocollapse */
        McBreadcrumbsComponent.ctorParameters = function () {
            return [
                { type: McBreadcrumbsService }
            ];
        };
        return McBreadcrumbsComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var McBreadcrumbsModule = (function () {
        function McBreadcrumbsModule() {
        }
        /**
         * @return {?}
         */
        McBreadcrumbsModule.forRoot = /**
         * @return {?}
         */
            function () {
                return {
                    ngModule: McBreadcrumbsModule,
                    providers: [McBreadcrumbsService, McBreadcrumbsConfig]
                };
            };
        McBreadcrumbsModule.decorators = [
            { type: core.NgModule, args: [{
                        imports: [common.CommonModule, router.RouterModule],
                        declarations: [McBreadcrumbsComponent],
                        exports: [McBreadcrumbsComponent]
                    },] },
        ];
        return McBreadcrumbsModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    exports.McBreadcrumbsComponent = McBreadcrumbsComponent;
    exports.McBreadcrumbsService = McBreadcrumbsService;
    exports.McBreadcrumbsConfig = McBreadcrumbsConfig;
    exports.McBreadcrumbsResolver = McBreadcrumbsResolver;
    exports.McBreadcrumbsModule = McBreadcrumbsModule;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWJyZWFkY3J1bWJzLnVtZC5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9tYy1icmVhZGNydW1icy5zaGFyZWQudHMiLCJuZzovL25neC1icmVhZGNydW1icy9zcmMvc2VydmljZS9tYy1icmVhZGNydW1icy5jb25maWcudHMiLCJuZzovL25neC1icmVhZGNydW1icy9zcmMvc2VydmljZS9tYy1icmVhZGNydW1icy5yZXNvbHZlci50cyIsIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9zZXJ2aWNlL21jLWJyZWFkY3J1bWJzLnNlcnZpY2UudHMiLCJuZzovL25neC1icmVhZGNydW1icy9zcmMvY29tcG9uZW50L21jLWJyZWFkY3J1bWJzLmNvbXBvbmVudC50cyIsIm5nOi8vbmd4LWJyZWFkY3J1bWJzL3NyYy9tYy1icmVhZGNydW1icy5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnJvbSwgb2YsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0ICogYXMgdGVtcGxhdGUgZnJvbSAnbG9kYXNoLnRlbXBsYXRlJztcbmltcG9ydCAqIGFzIHRlbXBsYXRlU2V0dGluZ3MgZnJvbSAnbG9kYXNoLnRlbXBsYXRlc2V0dGluZ3MnO1xuXG5jb25zdCBfID0ge1xuICB0ZW1wbGF0ZTogdGVtcGxhdGUsXG4gIHRlbXBsYXRlU2V0dGluZ3M6IHRlbXBsYXRlU2V0dGluZ3Ncbn07XG5cbl8udGVtcGxhdGVTZXR0aW5ncy5pbnRlcnBvbGF0ZSA9IC97eyhbXFxzXFxTXSs/KX19L2c7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUJyZWFkY3J1bWIge1xuICB0ZXh0OiBzdHJpbmc7XG4gIHBhdGg6IHN0cmluZztcbn1cblxuZGVjbGFyZSB2YXIgcmVxdWlyZTogYW55O1xuXG5mdW5jdGlvbiByKG1vZHVsZSkge1xuICByZXR1cm4gcmVxdWlyZShgJHtuYW1lfWApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5nRm9ybWF0KHRlbXBsYXRlOiBzdHJpbmcsIGJpbmRpbmc6IGFueSk6IHN0cmluZyB7XG4gIGNvbnN0IGNvbXBpbGVkID0gXy50ZW1wbGF0ZSh0ZW1wbGF0ZSk7XG4gIHJldHVybiBjb21waWxlZChiaW5kaW5nKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUHJvbWlzZSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdyYXBJbnRvT2JzZXJ2YWJsZTxUPihcbiAgdmFsdWU6IFQgfCBQcm9taXNlPFQ+IHwgT2JzZXJ2YWJsZTxUPlxuKTogT2JzZXJ2YWJsZTxUPiB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBpZiAoaXNQcm9taXNlKHZhbHVlKSkge1xuICAgIHJldHVybiBmcm9tKFByb21pc2UucmVzb2x2ZSh2YWx1ZSkpO1xuICB9XG5cbiAgcmV0dXJuIG9mKHZhbHVlIGFzIFQpO1xufVxuIiwiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJQnJlYWRjcnVtYiB9IGZyb20gJy4uL21jLWJyZWFkY3J1bWJzLnNoYXJlZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVBvc3RQcm9jZXNzRnVuYyB7XG4gIChjcnVtYnM6IElCcmVhZGNydW1iW10pOlxuICAgIHwgUHJvbWlzZTxJQnJlYWRjcnVtYltdPlxuICAgIHwgT2JzZXJ2YWJsZTxJQnJlYWRjcnVtYltdPlxuICAgIHwgSUJyZWFkY3J1bWJbXTtcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1jQnJlYWRjcnVtYnNDb25maWcge1xuICBwb3N0UHJvY2VzczogSVBvc3RQcm9jZXNzRnVuYztcbn1cbiIsImltcG9ydCB7XG4gIEFjdGl2YXRlZFJvdXRlU25hcHNob3QsXG4gIFJlc29sdmUsXG4gIFJvdXRlclN0YXRlU25hcHNob3QsXG4gIFVybFNlZ21lbnRcbn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IElCcmVhZGNydW1iLCBzdHJpbmdGb3JtYXQgfSBmcm9tICcuLi9tYy1icmVhZGNydW1icy5zaGFyZWQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IGNsYXNzIE1jQnJlYWRjcnVtYnNSZXNvbHZlciBpbXBsZW1lbnRzIFJlc29sdmU8SUJyZWFkY3J1bWJbXT4ge1xuICBwdWJsaWMgcmVzb2x2ZShcbiAgICByb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCxcbiAgICBzdGF0ZTogUm91dGVyU3RhdGVTbmFwc2hvdFxuICApOiBPYnNlcnZhYmxlPElCcmVhZGNydW1iW10+IHwgUHJvbWlzZTxJQnJlYWRjcnVtYltdPiB8IElCcmVhZGNydW1iW10ge1xuICAgIGNvbnN0IGRhdGEgPSByb3V0ZS5yb3V0ZUNvbmZpZy5kYXRhO1xuICAgIGNvbnN0IHBhdGggPSB0aGlzLmdldEZ1bGxQYXRoKHJvdXRlKTtcblxuICAgIGxldCB0ZXh0ID1cbiAgICAgIHR5cGVvZiBkYXRhLmJyZWFkY3J1bWJzID09PSAnc3RyaW5nJ1xuICAgICAgICA/IGRhdGEuYnJlYWRjcnVtYnNcbiAgICAgICAgOiBkYXRhLmJyZWFkY3J1bWJzLnRleHQgfHwgZGF0YS50ZXh0IHx8IHBhdGg7XG4gICAgdGV4dCA9IHN0cmluZ0Zvcm1hdCh0ZXh0LCByb3V0ZS5kYXRhKTtcblxuICAgIGNvbnN0IGNydW1iczogSUJyZWFkY3J1bWJbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgcGF0aDogcGF0aFxuICAgICAgfVxuICAgIF07XG5cbiAgICByZXR1cm4gb2YoY3J1bWJzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRGdWxsUGF0aChyb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IHN0cmluZyB7XG4gICAgY29uc3QgcmVsYXRpdmVQYXRoID0gKHNlZ21lbnRzOiBVcmxTZWdtZW50W10pID0+XG4gICAgICBzZWdtZW50cy5yZWR1Y2UoKGEsIHYpID0+IChhICs9ICcvJyArIHYucGF0aCksICcnKTtcbiAgICBjb25zdCBmdWxsUGF0aCA9IChyb3V0ZXM6IEFjdGl2YXRlZFJvdXRlU25hcHNob3RbXSkgPT5cbiAgICAgIHJvdXRlcy5yZWR1Y2UoKGEsIHYpID0+IChhICs9IHJlbGF0aXZlUGF0aCh2LnVybCkpLCAnJyk7XG5cbiAgICByZXR1cm4gZnVsbFBhdGgocm91dGUucGF0aEZyb21Sb290KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgTmF2aWdhdGlvbkVuZCwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgZmxhdE1hcCxcbiAgZGlzdGluY3QsXG4gIHRvQXJyYXksXG4gIGNvbmNhdCxcbiAgZmlyc3QsXG4gIGZpbHRlclxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IElCcmVhZGNydW1iLCB3cmFwSW50b09ic2VydmFibGUgfSBmcm9tICcuLi9tYy1icmVhZGNydW1icy5zaGFyZWQnO1xuaW1wb3J0IHsgTWNCcmVhZGNydW1ic0NvbmZpZyB9IGZyb20gJy4vbWMtYnJlYWRjcnVtYnMuY29uZmlnJztcbmltcG9ydCB7IE1jQnJlYWRjcnVtYnNSZXNvbHZlciB9IGZyb20gJy4vbWMtYnJlYWRjcnVtYnMucmVzb2x2ZXInO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWNCcmVhZGNydW1ic1NlcnZpY2Uge1xuICBwcml2YXRlIF9icmVhZGNydW1icyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8SUJyZWFkY3J1bWJbXT4oW10pO1xuICBwcml2YXRlIF9kZWZhdWx0UmVzb2x2ZXIgPSBuZXcgTWNCcmVhZGNydW1ic1Jlc29sdmVyKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBfY29uZmlnOiBNY0JyZWFkY3J1bWJzQ29uZmlnLFxuICAgIHByaXZhdGUgX2luamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICB0aGlzLl9yb3V0ZXIuZXZlbnRzXG4gICAgICAucGlwZShmaWx0ZXIoeCA9PiB4IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkpXG4gICAgICAuc3Vic2NyaWJlKChldmVudDogTmF2aWdhdGlvbkVuZCkgPT4ge1xuICAgICAgICBjb25zdCByb3V0ZSA9IF9yb3V0ZXIucm91dGVyU3RhdGUuc25hcHNob3Qucm9vdDtcblxuICAgICAgICB0aGlzLl9yZXNvbHZlQ3J1bWJzKHJvdXRlKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgZmxhdE1hcCh4ID0+IHgpLFxuICAgICAgICAgICAgZGlzdGluY3QoeCA9PiB4LnRleHQpLFxuICAgICAgICAgICAgdG9BcnJheSgpLFxuICAgICAgICAgICAgZmxhdE1hcCh4ID0+IHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmZpZy5wb3N0UHJvY2Vzcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl9jb25maWcucG9zdFByb2Nlc3MoeCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyYXBJbnRvT2JzZXJ2YWJsZTxJQnJlYWRjcnVtYltdPih5KS5waXBlKGZpcnN0KCkpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBvZih4KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG5cbiAgICAgICAgICAuc3Vic2NyaWJlKHggPT4ge1xuICAgICAgICAgICAgdGhpcy5fYnJlYWRjcnVtYnMubmV4dCh4KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZ2V0IGNydW1icyQoKTogT2JzZXJ2YWJsZTxJQnJlYWRjcnVtYltdPiB7XG4gICAgcmV0dXJuIHRoaXMuX2JyZWFkY3J1bWJzO1xuICB9XG5cbiAgcHJpdmF0ZSBfcmVzb2x2ZUNydW1icyhcbiAgICByb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdFxuICApOiBPYnNlcnZhYmxlPElCcmVhZGNydW1iW10+IHtcbiAgICBsZXQgY3J1bWJzJDogT2JzZXJ2YWJsZTxJQnJlYWRjcnVtYltdPjtcblxuICAgIGNvbnN0IGRhdGEgPSByb3V0ZS5yb3V0ZUNvbmZpZyAmJiByb3V0ZS5yb3V0ZUNvbmZpZy5kYXRhO1xuXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5icmVhZGNydW1icykge1xuICAgICAgbGV0IHJlc29sdmVyOiBNY0JyZWFkY3J1bWJzUmVzb2x2ZXI7XG5cbiAgICAgIGlmIChkYXRhLmJyZWFkY3J1bWJzLnByb3RvdHlwZSBpbnN0YW5jZW9mIE1jQnJlYWRjcnVtYnNSZXNvbHZlcikge1xuICAgICAgICByZXNvbHZlciA9IHRoaXMuX2luamVjdG9yLmdldChkYXRhLmJyZWFkY3J1bWJzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc29sdmVyID0gdGhpcy5fZGVmYXVsdFJlc29sdmVyO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSByZXNvbHZlci5yZXNvbHZlKHJvdXRlLCB0aGlzLl9yb3V0ZXIucm91dGVyU3RhdGUuc25hcHNob3QpO1xuICAgICAgY3J1bWJzJCA9IHdyYXBJbnRvT2JzZXJ2YWJsZTxJQnJlYWRjcnVtYltdPihyZXN1bHQpLnBpcGUoZmlyc3QoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNydW1icyQgPSBvZihbXSk7XG4gICAgfVxuXG4gICAgaWYgKHJvdXRlLmZpcnN0Q2hpbGQpIHtcbiAgICAgIGNydW1icyQgPSBjcnVtYnMkLnBpcGUoY29uY2F0KHRoaXMuX3Jlc29sdmVDcnVtYnMocm91dGUuZmlyc3RDaGlsZCkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3J1bWJzJDtcbiAgfVxufVxuIiwiaW1wb3J0IHsgTWNCcmVhZGNydW1ic1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL21jLWJyZWFkY3J1bWJzLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJQnJlYWRjcnVtYiB9IGZyb20gJy4uL21jLWJyZWFkY3J1bWJzLnNoYXJlZCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcbiAgc2VsZWN0b3I6ICdtYy1icmVhZGNydW1icycsXG4gIHRlbXBsYXRlOiBgPG9sICpuZ0lmPVwiY3J1bWJzLmxlbmd0aFwiIGNsYXNzPVwiYnJlYWRjcnVtYlwiPlxuICA8bGkgKm5nRm9yPVwibGV0IGNydW1iIG9mIGNydW1iczsgbGV0IGxhc3QgPSBsYXN0XCIgW25nQ2xhc3NdPVwieyAnYWN0aXZlJzogbGFzdCB9XCIgY2xhc3M9XCJicmVhZGNydW1iLWl0ZW1cIj5cbiAgICA8YSAqbmdJZj1cIiFsYXN0XCIgW3JvdXRlckxpbmtdPVwiY3J1bWIucGF0aFwiPnt7IGNydW1iLnRleHQgfX08L2E+XG4gICAgPHNwYW4gKm5nSWY9XCJsYXN0XCI+e3sgY3J1bWIudGV4dCB9fTwvc3Bhbj5cbiAgPC9saT5cbjwvb2w+XG5gXG59KVxuZXhwb3J0IGNsYXNzIE1jQnJlYWRjcnVtYnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzZXJ2aWNlOiBNY0JyZWFkY3J1bWJzU2VydmljZSkge31cblxuICBjcnVtYnM6IElCcmVhZGNydW1iW107XG5cbiAgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheTxTdWJzY3JpcHRpb24+KCk7XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IHMgPSB0aGlzLnNlcnZpY2UuY3J1bWJzJC5zdWJzY3JpYmUoeCA9PiB7XG4gICAgICB0aGlzLmNydW1icyA9IHg7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaCh4ID0+IHgudW5zdWJzY3JpYmUoKSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IFJvdXRlck1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgTWNCcmVhZGNydW1ic1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvbWMtYnJlYWRjcnVtYnMuc2VydmljZSc7XG5pbXBvcnQgeyBNb2R1bGVXaXRoUHJvdmlkZXJzLCBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWNCcmVhZGNydW1ic0NvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50L21jLWJyZWFkY3J1bWJzLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBNY0JyZWFkY3J1bWJzQ29uZmlnIH0gZnJvbSAnLi9zZXJ2aWNlL21jLWJyZWFkY3J1bWJzLmNvbmZpZyc7XG5cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtDb21tb25Nb2R1bGUsIFJvdXRlck1vZHVsZV0sXG4gIGRlY2xhcmF0aW9uczogW01jQnJlYWRjcnVtYnNDb21wb25lbnRdLFxuICBleHBvcnRzOiBbTWNCcmVhZGNydW1ic0NvbXBvbmVudF1cbn0pXG5leHBvcnQgY2xhc3MgTWNCcmVhZGNydW1ic01vZHVsZSB7XG4gIHN0YXRpYyBmb3JSb290KCk6IE1vZHVsZVdpdGhQcm92aWRlcnMge1xuICAgIHJldHVybiB7XG4gICAgICBuZ01vZHVsZTogTWNCcmVhZGNydW1ic01vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogW01jQnJlYWRjcnVtYnNTZXJ2aWNlLCBNY0JyZWFkY3J1bWJzQ29uZmlnXVxuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJ0ZW1wbGF0ZSIsIk9ic2VydmFibGUiLCJmcm9tIiwib2YiLCJJbmplY3RhYmxlIiwiQmVoYXZpb3JTdWJqZWN0IiwiZmlsdGVyIiwiTmF2aWdhdGlvbkVuZCIsImZsYXRNYXAiLCJkaXN0aW5jdCIsInRvQXJyYXkiLCJmaXJzdCIsImNvbmNhdCIsIlJvdXRlciIsIkluamVjdG9yIiwiQ29tcG9uZW50IiwiTmdNb2R1bGUiLCJDb21tb25Nb2R1bGUiLCJSb3V0ZXJNb2R1bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtJQUtBLElBQU0sQ0FBQyxHQUFHO1FBQ1IsUUFBUSxFQUFFLFFBQVE7UUFDbEIsZ0JBQWdCLEVBQUUsZ0JBQWdCO0tBQ25DLENBQUM7SUFFRixDQUFDLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxHQUFHLGlCQUFpQixDQUFDOzs7Ozs7QUFhbkQsMEJBQTZCQSxXQUFnQixFQUFFLE9BQVk7O1FBQ3pELElBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUNBLFdBQVEsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzFCOzs7OztBQUVELHVCQUEwQixLQUFVO1FBQ2xDLE9BQU8sS0FBSyxJQUFJLE9BQU8sS0FBSyxDQUFDLElBQUksS0FBSyxVQUFVLENBQUM7S0FDbEQ7Ozs7OztBQUVELGdDQUNFLEtBQXFDO1FBRXJDLElBQUksS0FBSyxZQUFZQyxlQUFVLEVBQUU7WUFDL0IsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BCLE9BQU9DLFNBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFD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